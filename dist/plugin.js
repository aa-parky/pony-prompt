(()=>{"use strict";var n={156:function(n,t,e){var r=this&&this.__createBinding||(Object.create?function(n,t,e,r){void 0===r&&(r=e);var o=Object.getOwnPropertyDescriptor(t,e);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,o)}:function(n,t,e,r){void 0===r&&(r=e),n[r]=t[e]}),o=this&&this.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),i=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(null!=n)for(var e in n)"default"!==e&&Object.prototype.hasOwnProperty.call(n,e)&&r(t,n,e);return o(t,n),t},l=this&&this.__awaiter||function(n,t,e,r){return new(e||(e=Promise))((function(o,i){function l(n){try{u(r.next(n))}catch(n){i(n)}}function a(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(l,a)}u((r=r.apply(n,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.info=void 0;const a=i(e(896)),u=i(e(928)),c="/home/aapark/development/comfy-managed/input/00_pony",s=["01_faces","02_clothing","03_posture","04_b","05_p","06_actions"];function f(n){const t=function(n){try{let t="";try{t=a.readFileSync(n,"utf-8")}catch(e){console.warn(`[PonyPlugin] Failed to read ${n} as utf-8, trying latin1...`),t=a.readFileSync(n,"latin1")}return t.split(/\r?\n/).map((n=>n.trim())).filter((n=>n.includes("=")))}catch(t){return console.warn(`[PonyPlugin] Error reading file ${n}:`,t),[]}}(n);if(0===t.length)return null;const e=t[Math.floor(Math.random()*t.length)].split("=",2);return e.length>1?e[1].trim():null}function p(n){const t=u.join(c,n);try{let n=a.readdirSync(t).filter((n=>{try{return a.statSync(u.join(t,n)).isFile()}catch(e){return console.warn(`[PonyPlugin] Error stating file ${u.join(t,n)}:`,e),!1}}));if(0===n.length)return console.warn(`[PonyPlugin] No files found in directory: ${t}`),null;for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(const e of n){const n=f(u.join(t,e));if(n)return n}return console.warn(`[PonyPlugin] No valid lines found in any file in directory: ${t}`),null}catch(n){return console.warn(`[PonyPlugin] Error reading directory ${t}:`,n),null}}t.info={id:"pony-prompt",name:"Pony Prompt",description:"Generates prompt components based on local text files for Pony Diffusion."},t.init=function(n){return l(this,void 0,void 0,(function*(){return console.log("[PonyPlugin] Initializing Pony Prompt Generator plugin..."),n.post("/generate",((n,t)=>{try{const e=n.body.user_text||"",r=function(){const n=[];for(const t of s){const e=p(t);e&&n.push(e)}return n.join(", ")}();let o="/imagine";if(e.trim()&&(o+=` ${e.trim()}`),r.trim()&&(o+=` ${r.trim()}`),"/imagine"===o&&!e.trim()&&!r.trim())return console.warn("[PonyPlugin] No user text and no components generated."),void t.status(400).json({error:"No prompt components could be generated and no user text was provided."});t.json({full_prompt:o})}catch(n){console.error("[PonyPlugin] Error in /generate endpoint:",n),t.status(500).json({error:"Internal server error while generating prompt."})}})),console.log("[PonyPlugin] Pony Prompt Generator plugin initialized with POST /generate endpoint."),Promise.resolve()}))}},896:n=>{n.exports=require("fs")},928:n=>{n.exports=require("path")}},t={};var e=function e(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return n[r].call(i.exports,i,i.exports,e),i.exports}(156);module.exports=e})();